
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quick start processor modules</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-book-theme.css?digest=84ace793992934648b4de8eed757e5a2" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx-book-theme.9d8b4a8b9bb19db25eeaddc40d639ba2.js"></script>
    <link rel="shortcut icon" href="../../_static/logo.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="IRIS Hooks" href="../hooks.html" />
    <link rel="prev" title="Modules development" href="../dev_modules.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<div class="col-12 col-md-3 bd-sidebar site-navigation " id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/logo_blue.png" class="logo" alt="logo">
      
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../index.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../quick_start.html">
   Quick Start
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../operations/index.html">
   Operations
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../operations/api.html">
     API
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../operations/upgrades.html">
     Upgrades
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../operations/modules.html">
     Modules
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../operations/reports.html">
     Reports
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../operations/tutorials.html">
     Tutorials
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../python_client/modules.html">
   Python client
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../python_client/v1.0.1/dfir_iris_client.html">
     Doc v1.0.1
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
    <label for="toctree-checkbox-3">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../python_client/v1.0.1/dfir_iris_client.admin.html">
       dfir_iris_client.admin module
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../python_client/v1.0.1/dfir_iris_client.case.html">
       dfir_iris_client.case module
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../python_client/v1.0.1/dfir_iris_client.customer.html">
       dfir_iris_client.customer module
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../python_client/v1.0.1/dfir_iris_client.global_search.html">
       dfir_iris_client.global_search module
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../python_client/v1.0.1/dfir_iris_client.session.html">
       dfir_iris_client.session module
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../python_client/v1.0.1/dfir_iris_client.users.html">
       dfir_iris_client.users module
      </a>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../python_client/v1.0.1/dfir_iris_client.helper.html">
       dfir_iris_client.helper package
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
      <label for="toctree-checkbox-4">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../python_client/v1.0.1/dfir_iris_client.helper.analysis_status.html">
         dfir_iris_client.helper.analysis_status module
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../python_client/v1.0.1/dfir_iris_client.helper.assets_type.html">
         dfir_iris_client.helper.assets_type module
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../python_client/v1.0.1/dfir_iris_client.helper.colors.html">
         dfir_iris_client.helper.colors module
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../python_client/v1.0.1/dfir_iris_client.helper.errors.html">
         dfir_iris_client.helper.errors module
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../python_client/v1.0.1/dfir_iris_client.helper.events_categories.html">
         dfir_iris_client.helper.events_categories module
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../python_client/v1.0.1/dfir_iris_client.helper.ioc_types.html">
         dfir_iris_client.helper.ioc_types module
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../python_client/v1.0.1/dfir_iris_client.helper.iris_object.html">
         dfir_iris_client.helper.iris_object module
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../python_client/v1.0.1/dfir_iris_client.helper.objects_def.html">
         dfir_iris_client.helper.objects_def module
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../python_client/v1.0.1/dfir_iris_client.helper.task_status.html">
         dfir_iris_client.helper.task_status module
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../python_client/v1.0.1/dfir_iris_client.helper.tlps.html">
         dfir_iris_client.helper.tlps module
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../python_client/v1.0.1/dfir_iris_client.helper.utils.html">
         dfir_iris_client.helper.utils module
        </a>
       </li>
      </ul>
     </li>
     <li class="toctree-l3 has-children">
      <a class="reference internal" href="../../python_client/v1.0.1/dfir_iris_client.tests.html">
       dfir_iris_client.tests package
      </a>
      <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
      <label for="toctree-checkbox-5">
       <i class="fas fa-chevron-down">
       </i>
      </label>
      <ul>
       <li class="toctree-l4">
        <a class="reference internal" href="../../python_client/v1.0.1/dfir_iris_client.tests.test_admin.html">
         dfir_iris_client.tests.test_admin module
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../python_client/v1.0.1/dfir_iris_client.tests.test_analysis_status.html">
         dfir_iris_client.tests.test_analysis_status module
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../python_client/v1.0.1/dfir_iris_client.tests.test_asset_type.html">
         dfir_iris_client.tests.test_asset_type module
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../python_client/v1.0.1/dfir_iris_client.tests.test_case.html">
         dfir_iris_client.tests.test_case module
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../python_client/v1.0.1/dfir_iris_client.tests.test_customer.html">
         dfir_iris_client.tests.test_customer module
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../python_client/v1.0.1/dfir_iris_client.tests.test_event_categories.html">
         dfir_iris_client.tests.test_event_categories module
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../python_client/v1.0.1/dfir_iris_client.tests.test_global_search.html">
         dfir_iris_client.tests.test_global_search module
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../python_client/v1.0.1/dfir_iris_client.tests.test_ioc_types.html">
         dfir_iris_client.tests.test_ioc_types module
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../python_client/v1.0.1/dfir_iris_client.tests.test_task_status.html">
         dfir_iris_client.tests.test_task_status module
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../python_client/v1.0.1/dfir_iris_client.tests.test_tlps.html">
         dfir_iris_client.tests.test_tlps module
        </a>
       </li>
       <li class="toctree-l4">
        <a class="reference internal" href="../../python_client/v1.0.1/dfir_iris_client.tests.tests_helper.html">
         dfir_iris_client.tests.tests_helper module
        </a>
       </li>
      </ul>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../index.html">
   Development
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 current active has-children">
    <a class="reference internal" href="../dev_modules.html">
     Modules
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
    <label for="toctree-checkbox-7">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="current">
     <li class="toctree-l3 current active">
      <a class="current reference internal" href="#">
       Getting started with processor modules
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../hooks.html">
     Hooks
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../dev_env.html">
     Developing IRIS Core
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../dev_docs.html">
     Documentation build
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../roadmap.html">
   Roadmap
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../qa.html">
   Q&amp;A
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
</div>

</div>


          


          
<!-- This is an invisible pixel that we watch to see if we've scrolled. -->
<div class="sbt-scroll-pixel-helper"></div>
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            <div class="topbar-left">
                
                <label class="nav-toggle-button" for="__navigation">
                    <div class="visually-hidden">Toggle navigation</div>
                    <i class="fas fa-bars"></i>
                </label>
                
            </div>
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/development/dev_mod_start/mod_processor.rst.txt"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.rst</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#project-structure-overview">
   Project structure overview
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#creating-the-interface">
   Creating the interface
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#writing-the-configuration">
   Writing the configuration
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#subscribing-to-a-hook">
   Subscribing to a hook
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Quick start processor modules</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#project-structure-overview">
   Project structure overview
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#creating-the-interface">
   Creating the interface
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#writing-the-configuration">
   Writing the configuration
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#subscribing-to-a-hook">
   Subscribing to a hook
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="section" id="quick-start-processor-modules">
<h1>Quick start processor modules<a class="headerlink" href="#quick-start-processor-modules" title="Permalink to this headline">¶</a></h1>
<p>In this tutorial, we demonstrate the steps to write a basic processor module which subscribes to a hook, and log what it receives when the hook is triggered. We will add
a configuration setting to offer our users the ability disable this feature.</p>
<p>We’ll call it <code class="docutils literal notranslate"><span class="pre">IrisDummyModule</span></code>.</p>
<div class="section" id="project-structure-overview">
<h2>Project structure overview<a class="headerlink" href="#project-structure-overview" title="Permalink to this headline">¶</a></h2>
<p>As described in the <a class="reference external" href="dev-module-main:">development module main page</a> , the module should have the following structure.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">setup</span><span class="o">.</span><span class="n">py</span>                <span class="c1"># Setup configuration to build the module</span>
<span class="n">README</span><span class="o">.</span><span class="n">md</span>               <span class="c1"># README</span>
<span class="n">iris_dummy_module</span>       <span class="c1"># Name of the package</span>
    <span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>              <span class="c1"># Declaration of the package and main class</span>
    <span class="n">IrisDummyConfig</span><span class="o">.</span><span class="n">py</span>       <span class="c1"># Configuration of the module to help keep the main file clean</span>
    <span class="n">IrisDummyInterface</span><span class="o">.</span><span class="n">py</span>    <span class="c1"># Main class of the module</span>
</pre></div>
</div>
<p>While the module could have only one main file <code class="docutils literal notranslate"><span class="pre">IrisDummyInterface.py</span></code>, we recommend splitting its configuration into a new configuration file (here <code class="docutils literal notranslate"><span class="pre">IrisDummyConfig.py</span></code>) to keep the code clear.</p>
<p>There is no mandatory naming convention for the files or the class or the methods. We chose this one to keep things clear, and we recommend following the same. But it’s up to the developer really.</p>
<p>We will walk over these files one by one during this tutorial.</p>
</div>
<div class="section" id="creating-the-interface">
<h2>Creating the interface<a class="headerlink" href="#creating-the-interface" title="Permalink to this headline">¶</a></h2>
<p>The interface is the code that talks with IRIS. It implements methods that call and are called by the server. It needs to inherit  <a class="reference external" href="https://github.com/dfir-iris/iris-module-interface/blob/master/iris_interface/IrisModuleInterface.py">IrisModuleInterface class</a> from the <a class="reference external" href="https://github.com/dfir-iris/iris-module-interface">IrisModuleInterface package</a>.  This module handles most of the methods needed by IRIS to recognize, set up and call the module.  By inheriting this class in our interface, we avoid writing that part ourselves.</p>
<p>Let’s write our basic interface class.  The name of the file has to be the name of the main class, that’s the only constraint. We’ll see later on why.</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">iris_dummy_module/IrisDummyInterface.py</span><a class="headerlink" href="#id3" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>

<span class="c1"># Import the IrisInterface class</span>
<span class="kn">from</span> <span class="nn">iris_interface.IrisModuleInterface</span> <span class="kn">import</span> <span class="n">IrisModuleInterface</span>

<span class="c1"># Create our module class</span>
<span class="k">class</span> <span class="nc">IrisDummyModule</span><span class="p">(</span><span class="n">IrisModuleInterface</span><span class="p">):</span>
    <span class="k">pass</span>
</pre></div>
</div>
</div>
<p>That’s it ! Actually this class is not doing anything right now. We’ll need to add a few methods to register our hook later.</p>
<p>But first we need to indicate to IRIS what is our main interface class. Remember, there is no convention restriction, so IRIS has no way to know which class it should instantiate to call our module.</p>
<p>To do so, we need to set a specific variable in our <cite>__init__.py</cite>.</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">iris_dummy_module/__init__.py</span><a class="headerlink" href="#id4" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set the __iris_module_interface variable to the name of our main class.</span>
<span class="c1"># When IRIS instantiate the python module, it looks for &quot;module.__iris_module_interface&quot;</span>
<span class="c1"># And then tries to instantiate the class &quot;__iris_module_interface.__iris_module_interface&quot;, here &#39;IrisDummyModule.IrisDummyModule&#39;.</span>
<span class="c1"># That&#39;s why the python file must have the same name as the class.</span>
<span class="n">__iris_module_interface</span> <span class="o">=</span> <span class="s2">&quot;IrisDummyModule&quot;</span>
</pre></div>
</div>
</div>
<p>Our module is now recognizable by IRIS ! Pretty simple right ?</p>
</div>
<div class="section" id="writing-the-configuration">
<h2>Writing the configuration<a class="headerlink" href="#writing-the-configuration" title="Permalink to this headline">¶</a></h2>
<p>The next step is to describe what the module is doing, its name, it’s configuration, etc.
This is done by overwriting predefines variables of the <code class="docutils literal notranslate"><span class="pre">IrisModuleInterface</span></code> class.</p>
<p>Let’s create our Python configuration file and go through each variables.</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">iris_dummy_module/IrisDummyConfig.py</span><a class="headerlink" href="#id5" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import the module types list,  so we can indicate the type of our module</span>
<span class="kn">from</span> <span class="nn">iris_interface.IrisModuleInterface</span> <span class="kn">import</span> <span class="n">IrisModuleTypes</span>

<span class="c1"># Human name displayed in the GUI Manage &gt; Modules. This can be anything,</span>
<span class="c1"># but try to put something meaningful, so users recognize your module.</span>
<span class="n">module_name</span> <span class="o">=</span> <span class="s2">&quot;IrisDummy&quot;</span>

<span class="c1"># Description displayed when editing the module configuration in the UI.</span>
<span class="c1"># This can be anything,</span>
<span class="n">module_description</span> <span class="o">=</span> <span class="s2">&quot;Provides a dummy module that replies to one hook&quot;</span>

<span class="c1"># Set the interface version used. This needs to be the version of</span>
<span class="c1"># the IrisModuleInterface package. This version is check by the server to</span>
<span class="c1"># to ensure our module can run on this specific server</span>
<span class="n">interface_version</span> <span class="o">=</span> <span class="mf">1.1</span>

<span class="c1"># The version of the module itself, it can be anything</span>
<span class="n">module_version</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="c1"># The type of the module, here processor</span>
<span class="n">module_type</span> <span class="o">=</span> <span class="n">IrisModuleTypes</span><span class="o">.</span><span class="n">module_processor</span>

<span class="c1"># Our module is a processor type, so it doesn&#39;t offer any pipeline</span>
<span class="n">pipeline_support</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># Provide no pipeline information as our module don&#39;t implement any</span>
<span class="n">pipeline_info</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1"># The configuration of the module that will be displayed and configurable</span>
<span class="c1"># by administrators on the UI. This describes every parameter that can</span>
<span class="c1"># be set.</span>
<span class="n">module_configuration</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;param_name&quot;</span><span class="p">:</span> <span class="s2">&quot;log_received_hook&quot;</span><span class="p">,</span>

        <span class="s2">&quot;param_human_name&quot;</span><span class="p">:</span> <span class="s2">&quot;Log received hook&quot;</span><span class="p">,</span>

        <span class="s2">&quot;param_description&quot;</span><span class="p">:</span> <span class="s2">&quot;Logs a message upon hook receiving if set to true. Otherwise do nothing.&quot;</span><span class="p">,</span>

        <span class="s2">&quot;default&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>

        <span class="s2">&quot;mandatory&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>

        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;bool&quot;</span>
    <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<dl class="simple">
<dt>The module configuration parameters are the following :</dt><dd><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">param_name</span></code> : The internal parameter name. This will be used by the module itself to fetch the value when needed.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">param_human_name</span></code> : The name displayed on the UI for this specific parameter</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">param_description</span></code>: A description explaining what this parameter is doing to help administrators</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">default</span></code>: The default value of our parameter. Here we set to True, so after install our module is already configured and ready to log the hook.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mandatory</span></code>:  Indicates whether the parameter is mandatory or not. If set to True  and no value is provided (either by admin or by default), the module is automatically disabled by IRIS</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">type</span></code>: The type of parameter. Here a boolean, which will be rendered under the form of a checkbox.</p></li>
</ul>
</dd>
</dl>
<p>A module can have as many parameters as it needs.</p>
<p>We now need to update our main class to set this configuration.</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">iris_dummy_module/IrisDummyInterface.py</span><a class="headerlink" href="#id6" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>

<span class="c1"># Import the IrisInterface class</span>
<span class="kn">from</span> <span class="nn">iris_interface.IrisModuleInterface</span> <span class="kn">import</span> <span class="n">IrisModuleInterface</span>

<span class="c1"># Create our module class</span>
<span class="k">class</span> <span class="nc">IrisDummyModule</span><span class="p">(</span><span class="n">IrisModuleInterface</span><span class="p">):</span>
    <span class="c1"># Set the configuration</span>
    <span class="n">_module_name</span> <span class="o">=</span> <span class="n">interface_conf</span><span class="o">.</span><span class="n">module_name</span>
    <span class="n">_module_description</span> <span class="o">=</span> <span class="n">interface_conf</span><span class="o">.</span><span class="n">module_description</span>
    <span class="n">_interface_version</span> <span class="o">=</span> <span class="n">interface_conf</span><span class="o">.</span><span class="n">interface_version</span>
    <span class="n">_module_version</span> <span class="o">=</span> <span class="n">interface_conf</span><span class="o">.</span><span class="n">module_version</span>
    <span class="n">_pipeline_support</span> <span class="o">=</span> <span class="n">interface_conf</span><span class="o">.</span><span class="n">pipeline_support</span>
    <span class="n">_pipeline_info</span> <span class="o">=</span> <span class="n">interface_conf</span><span class="o">.</span><span class="n">pipeline_info</span>
    <span class="n">_module_configuration</span> <span class="o">=</span> <span class="n">interface_conf</span><span class="o">.</span><span class="n">module_configuration</span>
    <span class="n">_module_type</span> <span class="o">=</span> <span class="n">interface_conf</span><span class="o">.</span><span class="n">module_type</span>

    <span class="k">pass</span>
</pre></div>
</div>
</div>
<p>Done ! The module is now providing enough information to IRIS, so it knows exactly what our module do and what needs to be called to run it.</p>
<p>However, our module is still doing nothing. Let’s make it subscribe to an IRIS hook.</p>
</div>
<div class="section" id="subscribing-to-a-hook">
<h2>Subscribing to a hook<a class="headerlink" href="#subscribing-to-a-hook" title="Permalink to this headline">¶</a></h2>
<p>Hooks allow to be notified by IRIS when a specific event occurs (IOC creation, deletion, etc). For a comprehensive description of hooks, please see the <a class="reference external" href="dev-iris-hooks">Hooks section</a> of this documentation.</p>
<dl class="simple">
<dt>The registration (or subscription) to a hook occurs at two moments during the life of a module :</dt><dd><ul class="simple">
<li><p>When the module is added to IRIS</p></li>
<li><p>When the configuration of the module is changed by an Admin. This allows dynamic subscription and deregistration of hooks depending on the config.</p></li>
</ul>
</dd>
</dl>
<p>These registration/deregistration events are triggered by IRIS, and are propagated to modules through the IrisModuleInterface method <code class="docutils literal notranslate"><span class="pre">register_hooks</span></code> (<a class="reference external" href="https://github.com/dfir-iris/iris-module-interface/blob/d63b358b1861e4545e983b67d9530469e3a87918/iris_interface/IrisModuleInterface.py#L389">ref</a>).</p>
<p>To register to a hook, we need to override this method and register our hook within this method.  To do so, IrisModuleInterface offers us another method <code class="docutils literal notranslate"><span class="pre">register_to_hook</span></code> (<a class="reference external" href="https://github.com/dfir-iris/iris-module-interface/blob/d63b358b1861e4545e983b67d9530469e3a87918/iris_interface/IrisModuleInterface.py#L401">ref</a>), which we can call for each hook we want to subscribe.</p>
<dl class="simple">
<dt>Here is a summary of the events :</dt><dd><ol class="arabic simple">
<li><p>IRIS calls <code class="docutils literal notranslate"><span class="pre">register_hooks</span></code> of our module. This indicates it is time for us to register our hooks.</p></li>
<li><p>Within this method, we call <code class="docutils literal notranslate"><span class="pre">register_to_hook</span></code> for each hook we want to subscribe</p></li>
</ol>
</dd>
</dl>
<p>Let’s add this to our main class and register to the <cite>on_postload_ioc_create</cite>. This will notify use each time a new IOC is created and committed to the database.</p>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">iris_dummy_module/IrisDummyInterface.py</span><a class="headerlink" href="#id7" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>

<span class="c1"># Import the IrisInterface class</span>
<span class="kn">from</span> <span class="nn">iris_interface.IrisModuleInterface</span> <span class="kn">import</span> <span class="n">IrisModuleInterface</span>


<span class="c1"># Create our module class</span>
<span class="k">class</span> <span class="nc">IrisDummyModule</span><span class="p">(</span><span class="n">IrisModuleInterface</span><span class="p">):</span>
    <span class="c1"># Set the configuration</span>
    <span class="n">_module_name</span> <span class="o">=</span> <span class="n">interface_conf</span><span class="o">.</span><span class="n">module_name</span>
    <span class="n">_module_description</span> <span class="o">=</span> <span class="n">interface_conf</span><span class="o">.</span><span class="n">module_description</span>
    <span class="n">_interface_version</span> <span class="o">=</span> <span class="n">interface_conf</span><span class="o">.</span><span class="n">interface_version</span>
    <span class="n">_module_version</span> <span class="o">=</span> <span class="n">interface_conf</span><span class="o">.</span><span class="n">module_version</span>
    <span class="n">_pipeline_support</span> <span class="o">=</span> <span class="n">interface_conf</span><span class="o">.</span><span class="n">pipeline_support</span>
    <span class="n">_pipeline_info</span> <span class="o">=</span> <span class="n">interface_conf</span><span class="o">.</span><span class="n">pipeline_info</span>
    <span class="n">_module_configuration</span> <span class="o">=</span> <span class="n">interface_conf</span><span class="o">.</span><span class="n">module_configuration</span>
    <span class="n">_module_type</span> <span class="o">=</span> <span class="n">interface_conf</span><span class="o">.</span><span class="n">module_type</span>

    <span class="k">def</span> <span class="nf">register_hooks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called by IRIS indicating it&#39;s time to register hooks.</span>

<span class="sd">        :param module_id: Module ID provided by IRIS.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Call the hook registration method. We need to pass the</span>
        <span class="c1"># the module_id to this method, otherwise IRIS won&#39;t know</span>
        <span class="c1"># to whom associate the hook.</span>
        <span class="c1"># The hook name needs to be a well known hook name by IRIS.</span>
        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">register_to_hook</span><span class="p">(</span><span class="n">module_id</span><span class="p">,</span> <span class="n">iris_hook_name</span><span class="o">=</span><span class="s1">&#39;on_postload_ioc_create&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">status</span><span class="o">.</span><span class="n">is_failure</span><span class="p">():</span>
            <span class="c1"># If we have a failure, log something out</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">status</span><span class="o">.</span><span class="n">get_message</span><span class="p">())</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Log that we successfully registered to the hook</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully subscribed to on_postload_ioc_create hook&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>That’s it. Our module has now officially subscribed to a hook and will be notified each time this event happens.</p>
<p>So how the module is notified ? Once again this is done by a method named <code class="docutils literal notranslate"><span class="pre">hooks_handler</span></code> (<a class="reference external" href="https://github.com/dfir-iris/iris-module-interface/blob/d63b358b1861e4545e983b67d9530469e3a87918/iris_interface/IrisModuleInterface.py#L373">ref</a>) that IrisModuleInterface provides, and we need to overwrite.</p>
<p>This method is called each time one of the event associated to the hook we subscribed to happen. It provides the name of the hook and as well as the data associated to it.  By overwriting this method, we can process the hook and the data !</p>
<p>We will add a condition in this method, that is if the administrator set the module parameter <code class="docutils literal notranslate"><span class="pre">log_received_hook</span></code> to False, then the module won’t log anything and simply do nothing.</p>
<p>The current configuration of the module can be accessed with the attribute <code class="docutils literal notranslate"><span class="pre">self._dict_conf</span></code>.</p>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text">iris_dummy_module/IrisDummyInterface.py</span><a class="headerlink" href="#id8" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>

<span class="c1"># Import the IrisInterface class</span>
<span class="kn">from</span> <span class="nn">iris_interface.IrisModuleInterface</span> <span class="kn">import</span> <span class="n">IrisModuleInterface</span>


<span class="c1"># Create our module class</span>
<span class="k">class</span> <span class="nc">IrisDummyModule</span><span class="p">(</span><span class="n">IrisModuleInterface</span><span class="p">):</span>
    <span class="c1"># Set the configuration</span>
    <span class="n">_module_name</span> <span class="o">=</span> <span class="n">interface_conf</span><span class="o">.</span><span class="n">module_name</span>
    <span class="n">_module_description</span> <span class="o">=</span> <span class="n">interface_conf</span><span class="o">.</span><span class="n">module_description</span>
    <span class="n">_interface_version</span> <span class="o">=</span> <span class="n">interface_conf</span><span class="o">.</span><span class="n">interface_version</span>
    <span class="n">_module_version</span> <span class="o">=</span> <span class="n">interface_conf</span><span class="o">.</span><span class="n">module_version</span>
    <span class="n">_pipeline_support</span> <span class="o">=</span> <span class="n">interface_conf</span><span class="o">.</span><span class="n">pipeline_support</span>
    <span class="n">_pipeline_info</span> <span class="o">=</span> <span class="n">interface_conf</span><span class="o">.</span><span class="n">pipeline_info</span>
    <span class="n">_module_configuration</span> <span class="o">=</span> <span class="n">interface_conf</span><span class="o">.</span><span class="n">module_configuration</span>
    <span class="n">_module_type</span> <span class="o">=</span> <span class="n">interface_conf</span><span class="o">.</span><span class="n">module_type</span>

    <span class="k">def</span> <span class="nf">register_hooks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">module_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called by IRIS indicating it&#39;s time to register hooks.</span>

<span class="sd">        :param module_id: Module ID provided by IRIS.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Call the hook registration method. We need to pass the</span>
        <span class="c1"># the module_id to this method, otherwise IRIS won&#39;t know</span>
        <span class="c1"># to whom associate the hook.</span>
        <span class="c1"># The hook name needs to be a well known hook name by IRIS.</span>
        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">register_to_hook</span><span class="p">(</span><span class="n">module_id</span><span class="p">,</span> <span class="n">iris_hook_name</span><span class="o">=</span><span class="s1">&#39;on_postload_ioc_create&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">status</span><span class="o">.</span><span class="n">is_failure</span><span class="p">():</span>
            <span class="c1"># If we have a failure, log something out</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="n">status</span><span class="o">.</span><span class="n">get_message</span><span class="p">())</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Log that we successfully registered to the hook</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully subscribed to on_postload_ioc_create hook&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">hooks_handler</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">hook_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Called by IRIS each time one of our hook is triggered.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># read the current configuration and only log the call if</span>
    <span class="c1"># our parameter is set to true</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dict_conf</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;log_received_hook&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Received </span><span class="si">{</span><span class="n">hook_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Received data of type </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># Return a standardized message to IRIS saying that everything is ok.</span>
    <span class="c1"># logs=list(self.message_queue) is needed, so the users can see the logs</span>
    <span class="c1"># our module generated during its execution.</span>
    <span class="k">return</span> <span class="n">InterfaceStatus</span><span class="o">.</span><span class="n">I2Success</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">logs</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">message_queue</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p><strong>We are done !</strong> Our module is now fully ready to register, subscribe to a hook and act when notified.</p>
</div>
</div>


              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="../dev_modules.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Modules development</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../hooks.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">IRIS Hooks</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By DFIR-IRIS Team<br/>
    
        &copy; Copyright 2022, Airbus CyberSecurity.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>